{{- define "apply_shortcode" -}}{{ $base_path := .Get "base_path" }}{{ $shortcode := .Get "shortcode" }}{{ $shortcode_name := findRE "{{%[ ]+[^ ]+[ ]" $shortcode }}{{ $shortcode_name = trim (replace (index $shortcode_name 0) "{{%" "") "  " }}{{ $args := findRE "\"([^\"]+)\"" $shortcode }}{{ if eq $shortcode_name "embed" }}{{ $src := trim (index $args 0) "\"\"" }}{{ $params := newScratch }}{{ $params.Set "src" $src }}{{ $params.Set "base_path" $base_path }}{{ template "embed" $params }}{{ else if eq $shortcode_name "video" }}{{ $src := trim (index $args 0) "\"\"" }}{{ $width := trim (index $args 1) "\"\"" }}{{ $params := newScratch }}{{ $params.Set "src" $src }}{{ $params.Set "width" $width }}{{ $params.Set "base_path" $base_path }}{{ template "video" $params }}{{ else if or (eq $shortcode_name "link") (eq $shortcode_name "download") }}{{ $src := trim (index $args 0) "\"\"" }}{{ $text := trim (index $args 1) "\"\"" }}{{ $download := false }}{{ if eq $shortcode_name "download" }}{{ $download = true }}{{ end }}{{ $params := newScratch }}{{ $params.Set "src" $src }}{{ $params.Set "text" $text }}{{ $params.Set "download" $download }}{{ $params.Set "base_path" $base_path }}{{ template "link" $params }}{{ end }}{{- end -}}